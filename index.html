<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原味交易平台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .logo {
            width: 75px;
            height: 75px;
            border-radius: 5px;
            overflow: hidden;
            margin-right: 20px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #eee;
            color: #999;
            font-size: 12px;
        }
        
        h1 {
            color: #4a5568;
        }
        
        .tabs {
            display: flex;
            background-color: #fff;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background-color: #f1f1f1;
            border-right: 1px solid #ddd;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab:hover {
            background-color: #e9e9e9;
        }
        
        .tab.active {
            background-color: #fff;
            border-bottom: 3px solid #4a90e2;
        }
        
        .tab-content {
            display: none;
            background-color: #fff;
            padding: 30px;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #4a5568;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 5px;
        }
        
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
        }
        
        .checkbox-item input, .radio-item input {
            width: auto;
            margin-right: 8px;
        }
        
        .btn {
            padding: 12px 25px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3a7bc8;
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        .password-prompt {
            text-align: center;
            padding: 50px 20px;
        }
        
        .password-prompt input {
            max-width: 300px;
            margin: 20px auto;
        }
        
        .data-container {
            margin-top: 30px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .empty-data {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .search-box {
            margin-bottom: 20px;
            display: flex;
        }
        
        .search-box input {
            flex: 1;
            border-radius: 4px 0 0 4px;
        }
        
        .search-box button {
            border-radius: 0 4px 4px 0;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: #4a90e2;
        }
        
        .image-preview {
            max-width: 300px;
            margin: 20px auto;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .setting-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
        }
        
        .poked-me-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        .poked-me-img {
            max-width: 500px;
            max-height: 500px;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .poked-me-img img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .message {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .image-modal img {
            max-width: 90%;
            max-height: 90%;
        }
        
        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            color: #777;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 50%;
                text-align: center;
                padding: 12px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .modal {
                padding: 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo" id="siteLogo">
                <div class="logo-placeholder">LOGO</div>
            </div>
            <h1>原味交易平台</h1>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="account-info">账号信息</div>
            <div class="tab" data-tab="account-query">账号信息查询</div>
            <div class="tab" data-tab="post-publish">发布帖子</div>
            <div class="tab" data-tab="post-reply">回复帖子</div>
            <div class="tab" data-tab="settings">设置</div>
            <div class="tab" data-tab="poked-me">戳戳我</div>
        </div>
        
        <!-- 账号信息标签页 -->
        <div class="tab-content active" id="account-info">
            <h2>账号信息</h2>
            <p>在此页面可以申请新的账号，提交后请记住系统生成的密码。</p>
            <button class="btn" id="showAccountForm">申请新账号</button>
            
            <div class="data-container">
                <h3>账号申请记录</h3>
                <div class="empty-data">等待数据上传</div>
            </div>
        </div>
        
        <!-- 账号信息查询标签页 -->
        <div class="tab-content" id="account-query">
            <h2>账号信息查询</h2>
            <div class="password-prompt" id="accountQueryPasswordPrompt">
                <p>请输入管理密码以查看账号信息</p>
                <input type="password" id="accountQueryPassword" placeholder="请输入管理密码">
                <button class="btn" id="submitAccountQueryPassword">提交</button>
            </div>
            <div class="data-content" id="accountQueryData" style="display: none;">
                <div class="search-box">
                    <input type="text" id="accountSearch" placeholder="搜索昵称、名称或手机尾号...">
                    <button class="btn" id="searchAccountBtn">搜索</button>
                </div>
                <div class="data-container">
                    <table class="data-table" id="accountTable">
                        <thead>
                            <tr>
                                <th>昵称</th>
                                <th>名称</th>
                                <th>年龄</th>
                                <th>身高(cm)</th>
                                <th>体重(kg)</th>
                                <th>属性</th>
                                <th>SM属性</th>
                                <th>屌长(cm)</th>
                                <th>屌粗(cm)</th>
                                <th>特殊喜好</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="11" class="empty-data">等待数据上传</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 发布帖子标签页 -->
        <div class="tab-content" id="post-publish">
            <h2>发布帖子</h2>
            <div class="password-prompt" id="postPublishPasswordPrompt">
                <p>请输入用户密码以发布帖子</p>
                <input type="password" id="postPublishPassword" placeholder="请输入用户密码">
                <button class="btn" id="submitPostPublishPassword">提交</button>
            </div>
            <div class="data-content" id="postPublishData" style="display: none;">
                <button class="btn" id="showPostForm">发布新帖子</button>
                
                <div class="data-container">
                    <h3>已发布的帖子</h3>
                    <div class="search-box">
                        <input type="text" id="postSearch" placeholder="搜索帖子标题、昵称或编号...">
                        <button class="btn" id="searchPostBtn">搜索</button>
                    </div>
                    <table class="data-table" id="postTable">
                        <thead>
                            <tr>
                                <th>发帖编号</th>
                                <th>昵称</th>
                                <th>手机尾号</th>
                                <th>帖子标题</th>
                                <th>发布日期</th>
                                <th>交易类型</th>
                                <th>定向人群</th>
                                <th>交易方式</th>
                                <th>交易价格(元)</th>
                                <th>要求</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="11" class="empty-data">等待发帖中</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 回复帖子标签页 -->
        <div class="tab-content" id="post-reply">
            <h2>回复帖子</h2>
            <div class="password-prompt" id="postReplyPasswordPrompt">
                <p>请输入用户密码以回复帖子</p>
                <input type="password" id="postReplyPassword" placeholder="请输入用户密码">
                <button class="btn" id="submitPostReplyPassword">提交</button>
            </div>
            <div class="data-content" id="postReplyData" style="display: none;">
                <button class="btn" id="showReplyForm">回复帖子</button>
                
                <div class="data-container">
                    <h3>回帖记录</h3>
                    <div class="search-box">
                        <input type="text" id="replySearch" placeholder="搜索原帖编号、昵称或发帖编号...">
                        <button class="btn" id="searchReplyBtn">搜索</button>
                    </div>
                    <table class="data-table" id="replyTable">
                        <thead>
                            <tr>
                                <th>原帖编号</th>
                                <th>发帖编号</th>
                                <th>昵称</th>
                                <th>手机尾号</th>
                                <th>回帖日期</th>
                                <th>交易类型</th>
                                <th>定向人群</th>
                                <th>交易方式</th>
                                <th>交易价格</th>
                                <th>备注</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="11" class="empty-data">等待发帖中</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 设置标签页 -->
        <div class="tab-content" id="settings">
            <h2>设置</h2>
            <div class="password-prompt" id="settingsPasswordPrompt">
                <p>请输入管理密码以进入设置</p>
                <input type="password" id="settingsPassword" placeholder="请输入管理密码">
                <button class="btn" id="submitSettingsPassword">提交</button>
            </div>
            <div class="settings-container" id="settingsData" style="display: none;">
                <div class="setting-section">
                    <h3>LOGO设置</h3>
                    <p>支持上传的格式为JPG、JPEG、PNG，尺寸为75cm*75cm</p>
                    <div class="upload-area" id="logoUploadArea">
                        <p>点击或拖拽文件到此处上传LOGO</p>
                        <p><small>支持JPG、JPEG、PNG格式，建议尺寸75×75像素</small></p>
                        <input type="file" id="logoUpload" accept=".jpg,.jpeg,.png" style="display: none;">
                    </div>
                    <div class="image-preview" id="logoPreview">
                        <!-- LOGO预览会在这里显示 -->
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="modifyLogo">修改LOGO</button>
                        <button class="btn btn-danger" id="deleteLogo">删除LOGO</button>
                    </div>
                </div>
                
                <div class="setting-section">
                    <h3>背景设置</h3>
                    <p>支持上传的格式为JPG、JPEG、PNG，上传后将覆盖显示整个网页</p>
                    <div class="upload-area" id="bgUploadArea">
                        <p>点击或拖拽文件到此处上传背景图片</p>
                        <p><small>支持JPG、JPEG、PNG格式</small></p>
                        <input type="file" id="bgUpload" accept=".jpg,.jpeg,.png" style="display: none;">
                    </div>
                    <div class="image-preview" id="bgPreview">
                        <!-- 背景预览会在这里显示 -->
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="modifyBg">修改背景</button>
                        <button class="btn btn-danger" id="deleteBg">删除背景</button>
                    </div>
                </div>
                
                <div class="setting-section">
                    <h3>戳戳我图片设置</h3>
                    <p>支持上传的格式为JPG、JPEG、PNG，上传后的图片将显示在"戳戳我"标签页</p>
                    <div class="upload-area" id="pokedMeUploadArea">
                        <p>点击或拖拽文件到此处上传戳戳我图片</p>
                        <p><small>支持JPG、JPEG、PNG格式</small></p>
                        <input type="file" id="pokedMeUpload" accept=".jpg,.jpeg,.png" style="display: none;">
                    </div>
                    <div class="image-preview" id="pokedMePreview">
                        <!-- 戳戳我图片预览会在这里显示 -->
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="modifyPokedMe">修改图片</button>
                        <button class="btn btn-danger" id="deletePokedMe">删除图片</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 戳戳我标签页 -->
        <div class="tab-content" id="poked-me">
            <h2>戳戳我</h2>
            <div class="poked-me-container">
                <div class="poked-me-img" id="pokedMeImageContainer">
                    <div class="empty-data">请先在设置页面上传图片</div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>原味交易平台 &copy; 2023 - 仅供演示使用</p>
        </footer>
    </div>
    
    <!-- 账号信息弹窗 -->
    <div class="modal-overlay" id="accountModal" style="display: none;">
        <div class="modal">
            <h3>账号申请</h3>
            <form id="accountForm">
                <div class="form-group">
                    <label for="nickname">昵称:</label>
                    <input type="text" id="nickname" required>
                </div>
                <div class="form-group">
                    <label for="username">名称:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="phone">手机尾号:</label>
                    <input type="text" id="phone" maxlength="4" required>
                </div>
                <div class="form-group">
                    <label for="age">年龄:</label>
                    <input type="number" id="age" min="1" max="100" required>
                </div>
                <div class="form-group">
                    <label for="height">身高(厘米):</label>
                    <input type="number" id="height" min="100" max="250" required>
                </div>
                <div class="form-group">
                    <label for="weight">体重(公斤):</label>
                    <input type="number" step="0.1" id="weight" min="30" max="200" required>
                </div>
                <div class="form-group">
                    <label for="attribute">属性:</label>
                    <select id="attribute" required>
                        <option value="">请选择</option>
                        <option value="1">1</option>
                        <option value="0">0</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>SM属性:</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="sm-s" name="smAttribute" value="S" required>
                            <label for="sm-s">S</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="sm-m" name="smAttribute" value="M">
                            <label for="sm-m">M</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="sm-sub" name="smAttribute" value="Sub">
                            <label for="sm-sub">Sub</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="sm-dom" name="smAttribute" value="Dom">
                            <label for="sm-dom">Dom</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="dickLength">屌长(厘米):</label>
                    <input type="number" step="0.1" id="dickLength" min="1" max="30" required>
                </div>
                <div class="form-group">
                    <label for="dickThickness">屌粗(厘米):</label>
                    <input type="number" step="0.1" id="dickThickness" min="1" max="20" required>
                </div>
                <div class="form-group">
                    <label for="preference">特殊喜好:</label>
                    <textarea id="preference" placeholder="原味/圣水/捆绑等" required></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn">提交</button>
                    <button type="button" class="btn btn-secondary" id="cancelAccountForm">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 密码提示消息 -->
    <div class="message" id="passwordMessage" style="display: none;"></div>
    
    <!-- 图片查看模态框 -->
    <div class="image-modal" id="imageModal" style="display: none;">
        <span class="image-modal-close">&times;</span>
        <img id="modalImage" src="" alt="查看图片">
    </div>

    <script>
        // 存储数据
        let accounts = [];
        let posts = [];
        let replies = [];
        let settings = {
            logo: null,
            background: null,
            pokedMe: null
        };
        
        // 密码配置
        const PASSWORDS = {
            admin: '740302',
            user: '000000'
        };
        
        // 当前激活的标签页
        let activeTab = 'account-info';
        
        // DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 从本地存储加载数据
            loadDataFromStorage();
            
            // 恢复之前的标签页
            const savedTab = sessionStorage.getItem('activeTab');
            if (savedTab) {
                switchTab(savedTab);
            }
            
            // 设置标签页切换事件
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // 账号信息标签页
            document.getElementById('showAccountForm').addEventListener('click', showAccountForm);
            document.getElementById('cancelAccountForm').addEventListener('click', hideAccountForm);
            document.getElementById('accountForm').addEventListener('submit', handleAccountSubmit);
            
            // 账号信息查询标签页
            document.getElementById('submitAccountQueryPassword').addEventListener('click', function() {
                const password = document.getElementById('accountQueryPassword').value;
                if (password === PASSWORDS.admin) {
                    document.getElementById('accountQueryPasswordPrompt').style.display = 'none';
                    document.getElementById('accountQueryData').style.display = 'block';
                    updateAccountTable();
                } else {
                    showMessage('密码错误，请重新输入', 'error');
                }
            });
            
            document.getElementById('searchAccountBtn').addEventListener('click', searchAccounts);
            document.getElementById('accountSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchAccounts();
            });
            
            // 发布帖子标签页
            document.getElementById('submitPostPublishPassword').addEventListener('click', function() {
                const password = document.getElementById('postPublishPassword').value;
                if (password === PASSWORDS.user) {
                    document.getElementById('postPublishPasswordPrompt').style.display = 'none';
                    document.getElementById('postPublishData').style.display = 'block';
                    updatePostTable();
                } else {
                    showMessage('密码错误，请重新输入', 'error');
                }
            });
            
            document.getElementById('showPostForm').addEventListener('click', showPostForm);
            document.getElementById('searchPostBtn').addEventListener('click', searchPosts);
            document.getElementById('postSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchPosts();
            });
            
            // 回复帖子标签页
            document.getElementById('submitPostReplyPassword').addEventListener('click', function() {
                const password = document.getElementById('postReplyPassword').value;
                if (password === PASSWORDS.user) {
                    document.getElementById('postReplyPasswordPrompt').style.display = 'none';
                    document.getElementById('postReplyData').style.display = 'block';
                    updateReplyTable();
                } else {
                    showMessage('密码错误，请重新输入', 'error');
                }
            });
            
            document.getElementById('showReplyForm').addEventListener('click', showReplyForm);
            document.getElementById('searchReplyBtn').addEventListener('click', searchReplies);
            document.getElementById('replySearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchReplies();
            });
            
            // 设置标签页
            document.getElementById('submitSettingsPassword').addEventListener('click', function() {
                const password = document.getElementById('settingsPassword').value;
                if (password === PASSWORDS.admin) {
                    document.getElementById('settingsPasswordPrompt').style.display = 'none';
                    document.getElementById('settingsData').style.display = 'block';
                    updateSettingsPreview();
                } else {
                    showMessage('密码错误，请重新输入', 'error');
                }
            });
            
            // 文件上传功能
            setupFileUpload('logoUpload', 'logoUploadArea', handleLogoUpload);
            setupFileUpload('bgUpload', 'bgUploadArea', handleBackgroundUpload);
            setupFileUpload('pokedMeUpload', 'pokedMeUploadArea', handlePokedMeUpload);
            
            // 修改和删除按钮
            document.getElementById('modifyLogo').addEventListener('click', function() {
                document.getElementById('logoUpload').click();
            });
            
            document.getElementById('deleteLogo').addEventListener('click', function() {
                settings.logo = null;
                saveDataToStorage();
                updateSettingsPreview();
                showMessage('LOGO已删除', 'success');
            });
            
            document.getElementById('modifyBg').addEventListener('click', function() {
                document.getElementById('bgUpload').click();
            });
            
            document.getElementById('deleteBg').addEventListener('click', function() {
                settings.background = null;
                document.body.style.backgroundImage = '';
                saveDataToStorage();
                updateSettingsPreview();
                showMessage('背景已删除', 'success');
            });
            
            document.getElementById('modifyPokedMe').addEventListener('click', function() {
                document.getElementById('pokedMeUpload').click();
            });
            
            document.getElementById('deletePokedMe').addEventListener('click', function() {
                settings.pokedMe = null;
                saveDataToStorage();
                updateSettingsPreview();
                showMessage('戳戳我图片已删除', 'success');
            });
            
            // 图片查看功能
            document.getElementById('siteLogo').addEventListener('click', function() {
                if (settings.logo) {
                    showImageModal(settings.logo);
                }
            });
            
            document.getElementById('pokedMeImageContainer').addEventListener('click', function() {
                if (settings.pokedMe) {
                    showImageModal(settings.pokedMe);
                }
            });
            
            document.querySelector('.image-modal-close').addEventListener('click', hideImageModal);
            
            // 初始更新预览
            updateSettingsPreview();
            
            // 设置背景图片
            if (settings.background) {
                document.body.style.backgroundImage = `url(${settings.background})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
            }
        });
        
        // 切换标签页
        function switchTab(tabId) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有标签的激活状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签内容
            document.getElementById(tabId).classList.add('active');
            
            // 激活选中的标签
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            
            // 保存当前标签页
            activeTab = tabId;
            sessionStorage.setItem('activeTab', tabId);
            
            // 如果是戳戳我标签页，更新图片显示
            if (tabId === 'poked-me') {
                updatePokedMeImage();
            }
        }
        
        // 显示账号申请表单
        function showAccountForm() {
            document.getElementById('accountModal').style.display = 'flex';
        }
        
        // 隐藏账号申请表单
        function hideAccountForm() {
            document.getElementById('accountModal').style.display = 'none';
            document.getElementById('accountForm').reset();
        }
        
        // 处理账号提交
        function handleAccountSubmit(e) {
            e.preventDefault();
            
            const account = {
                id: Date.now(),
                nickname: document.getElementById('nickname').value,
                username: document.getElementById('username').value,
                phone: document.getElementById('phone').value,
                age: document.getElementById('age').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                attribute: document.getElementById('attribute').value,
                smAttribute: document.querySelector('input[name="smAttribute"]:checked').value,
                dickLength: document.getElementById('dickLength').value,
                dickThickness: document.getElementById('dickThickness').value,
                preference: document.getElementById('preference').value
            };
            
            accounts.push(account);
            saveDataToStorage();
            
            // 显示密码提示
            const messageDiv = document.getElementById('passwordMessage');
            messageDiv.textContent = '用户密码为000000';
            messageDiv.className = 'message success';
            messageDiv.style.display = 'block';
            
            // 5秒后隐藏消息
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
            
            // 隐藏表单
            hideAccountForm();
            
            // 重置表单
            document.getElementById('accountForm').reset();
        }
        
        // 更新账号表格
        function updateAccountTable(filteredAccounts = null) {
            const tableBody = document.querySelector('#accountTable tbody');
            const data = filteredAccounts || accounts;
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="11" class="empty-data">等待数据上传</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            data.forEach(account => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${account.nickname}</td>
                    <td>${account.username}</td>
                    <td>${account.age}</td>
                    <td>${account.height}</td>
                    <td>${account.weight}</td>
                    <td>${account.attribute}</td>
                    <td>${account.smAttribute}</td>
                    <td>${account.dickLength}</td>
                    <td>${account.dickThickness}</td>
                    <td>${account.preference}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-secondary" onclick="editAccount(${account.id})">修改</button>
                            <button class="btn btn-small btn-danger" onclick="deleteAccount(${account.id})">删除</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // 搜索账号
        function searchAccounts() {
            const searchTerm = document.getElementById('accountSearch').value.toLowerCase();
            if (!searchTerm) {
                updateAccountTable();
                return;
            }
            
            const filtered = accounts.filter(account => 
                account.nickname.toLowerCase().includes(searchTerm) ||
                account.username.toLowerCase().includes(searchTerm) ||
                account.phone.includes(searchTerm)
            );
            
            updateAccountTable(filtered);
        }
        
        // 编辑账号
        function editAccount(id) {
            const account = accounts.find(a => a.id === id);
            if (!account) return;
            
            // 这里可以添加编辑功能
            // 由于时间关系，这里只显示一个提示
            showMessage('编辑功能将在后续版本中实现', 'success');
        }
        
        // 删除账号
        function deleteAccount(id) {
            if (confirm('确定要删除此账号信息吗？')) {
                accounts = accounts.filter(a => a.id !== id);
                saveDataToStorage();
                updateAccountTable();
                showMessage('账号信息已删除', 'success');
            }
        }
        
        // 显示发布帖子表单
        function showPostForm() {
            // 生成发帖编号
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const postCount = posts.filter(p => p.postId.startsWith(dateStr)).length + 1;
            const postId = `${dateStr}${postCount.toString().padStart(3, '0')}`;
            
            // 生成发布日期
            const publishDate = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日 ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            // 创建表单
            const formHtml = `
                <div class="modal-overlay" id="postModal" style="display: flex;">
                    <div class="modal">
                        <h3>发布帖子</h3>
                        <form id="postForm">
                            <div class="form-group">
                                <label for="postId">发帖编号:</label>
                                <input type="text" id="postId" value="${postId}" readonly>
                            </div>
                            <div class="form-group">
                                <label for="postNickname">昵称:</label>
                                <input type="text" id="postNickname" required>
                            </div>
                            <div class="form-group">
                                <label for="postPhone">手机尾号:</label>
                                <input type="text" id="postPhone" maxlength="4" required>
                            </div>
                            <div class="form-group">
                                <label for="postTitle">帖子标题:</label>
                                <input type="text" id="postTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="postDate">发布日期:</label>
                                <input type="text" id="postDate" value="${publishDate}" readonly>
                            </div>
                            <div class="form-group">
                                <label>交易类型:</label>
                                <div class="checkbox-group" id="tradeTypeGroup">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="type-socks" name="tradeType" value="袜子">
                                        <label for="type-socks">袜子</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="type-underwear" name="tradeType" value="内裤">
                                        <label for="type-underwear">内裤</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="type-shoes" name="tradeType" value="鞋">
                                        <label for="type-shoes">鞋</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="type-other" name="tradeType" value="其他">
                                        <label for="type-other">其他</label>
                                    </div>
                                </div>
                                <div id="tradeTypeOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="tradeTypeOther" placeholder="请输入其他交易类型">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>定向人群:</label>
                                <div class="checkbox-group" id="targetGroup">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-military" name="target" value="军">
                                        <label for="target-military">军</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-police" name="target" value="警">
                                        <label for="target-police">警</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-fire" name="target" value="消">
                                        <label for="target-fire">消</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-security" name="target" value="保安">
                                        <label for="target-security">保安</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-worker" name="target" value="民工">
                                        <label for="target-worker">民工</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="target-other" name="target" value="其他">
                                        <label for="target-other">其他</label>
                                    </div>
                                </div>
                                <div id="targetOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="targetOther" placeholder="请输入其他定向人群">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>交易方式:</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="method-delivery" name="tradeMethod" value="快递" checked>
                                        <label for="method-delivery">快递</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="method-meet" name="tradeMethod" value="面交">
                                        <label for="method-meet">面交</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="method-other" name="tradeMethod" value="其他">
                                        <label for="method-other">其他</label>
                                    </div>
                                </div>
                                <div id="methodOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="methodOther" placeholder="请输入其他交易方式">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="price">交易价格(元):</label>
                                <input type="number" id="price" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="requirements">要求:</label>
                                <textarea id="requirements" required></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn">提交</button>
                                <button type="button" class="btn btn-secondary" id="cancelPostForm">取消</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            // 添加表单到页面
            const formContainer = document.createElement('div');
            formContainer.innerHTML = formHtml;
            document.body.appendChild(formContainer.firstChild);
            
            // 添加事件监听器
            document.getElementById('type-other').addEventListener('change', function() {
                document.getElementById('tradeTypeOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('target-other').addEventListener('change', function() {
                document.getElementById('targetOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('method-other').addEventListener('change', function() {
                document.getElementById('methodOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('cancelPostForm').addEventListener('click', function() {
                document.getElementById('postModal').remove();
            });
            
            document.getElementById('postForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 收集交易类型
                const tradeTypes = [];
                document.querySelectorAll('input[name="tradeType"]:checked').forEach(cb => {
                    if (cb.value === '其他') {
                        const otherValue = document.getElementById('tradeTypeOther').value;
                        if (otherValue) tradeTypes.push(`其他: ${otherValue}`);
                    } else {
                        tradeTypes.push(cb.value);
                    }
                });
                
                // 收集定向人群
                const targets = [];
                document.querySelectorAll('input[name="target"]:checked').forEach(cb => {
                    if (cb.value === '其他') {
                        const otherValue = document.getElementById('targetOther').value;
                        if (otherValue) targets.push(`其他: ${otherValue}`);
                    } else {
                        targets.push(cb.value);
                    }
                });
                
                // 获取交易方式
                let tradeMethod = document.querySelector('input[name="tradeMethod"]:checked').value;
                if (tradeMethod === '其他') {
                    const otherValue = document.getElementById('methodOther').value;
                    if (otherValue) tradeMethod = `其他: ${otherValue}`;
                }
                
                const post = {
                    id: Date.now(),
                    postId: document.getElementById('postId').value,
                    nickname: document.getElementById('postNickname').value,
                    phone: document.getElementById('postPhone').value,
                    title: document.getElementById('postTitle').value,
                    date: document.getElementById('postDate').value,
                    tradeTypes: tradeTypes.join(', '),
                    targets: targets.join(', '),
                    tradeMethod: tradeMethod,
                    price: document.getElementById('price').value,
                    requirements: document.getElementById('requirements').value
                };
                
                posts.push(post);
                saveDataToStorage();
                updatePostTable();
                
                // 移除表单
                document.getElementById('postModal').remove();
                
                showMessage('帖子发布成功', 'success');
            });
        }
        
        // 更新帖子表格
        function updatePostTable(filteredPosts = null) {
            const tableBody = document.querySelector('#postTable tbody');
            const data = filteredPosts || posts;
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="11" class="empty-data">等待发帖中</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            data.forEach(post => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${post.postId}</td>
                    <td>${post.nickname}</td>
                    <td>${post.phone}</td>
                    <td>${post.title}</td>
                    <td>${post.date}</td>
                    <td>${post.tradeTypes}</td>
                    <td>${post.targets}</td>
                    <td>${post.tradeMethod}</td>
                    <td>${post.price}</td>
                    <td>${post.requirements}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-secondary" onclick="editPost(${post.id})">修改</button>
                            <button class="btn btn-small btn-danger" onclick="deletePost(${post.id})">删除</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // 搜索帖子
        function searchPosts() {
            const searchTerm = document.getElementById('postSearch').value.toLowerCase();
            if (!searchTerm) {
                updatePostTable();
                return;
            }
            
            const filtered = posts.filter(post => 
                post.postId.toLowerCase().includes(searchTerm) ||
                post.nickname.toLowerCase().includes(searchTerm) ||
                post.title.toLowerCase().includes(searchTerm) ||
                post.phone.includes(searchTerm)
            );
            
            updatePostTable(filtered);
        }
        
        // 编辑帖子
        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (!post) return;
            
            // 这里可以添加编辑功能
            // 由于时间关系，这里只显示一个提示
            showMessage('编辑功能将在后续版本中实现', 'success');
        }
        
        // 删除帖子
        function deletePost(id) {
            if (confirm('确定要删除此帖子吗？')) {
                posts = posts.filter(p => p.id !== id);
                saveDataToStorage();
                updatePostTable();
                showMessage('帖子已删除', 'success');
            }
        }
        
        // 显示回复帖子表单
        function showReplyForm() {
            // 生成发帖编号
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const replyCount = replies.filter(r => r.replyId.startsWith(dateStr)).length + 1;
            const replyId = `${dateStr}${replyCount.toString().padStart(3, '0')}`;
            
            // 生成回帖日期
            const replyDate = `${now.getFullYear()}年${now.getMonth()+1}月${now.getDate()}日 ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            // 创建表单
            const formHtml = `
                <div class="modal-overlay" id="replyModal" style="display: flex;">
                    <div class="modal">
                        <h3>回复帖子</h3>
                        <form id="replyForm">
                            <div class="form-group">
                                <label for="originalPostId">原帖编号:</label>
                                <input type="text" id="originalPostId" required>
                            </div>
                            <div class="form-group">
                                <label for="replyId">发帖编号:</label>
                                <input type="text" id="replyId" value="${replyId}" readonly>
                            </div>
                            <div class="form-group">
                                <label for="replyNickname">昵称:</label>
                                <input type="text" id="replyNickname" required>
                            </div>
                            <div class="form-group">
                                <label for="replyPhone">手机尾号:</label>
                                <input type="text" id="replyPhone" maxlength="4" required>
                            </div>
                            <div class="form-group">
                                <label for="replyDate">回帖日期:</label>
                                <input type="text" id="replyDate" value="${replyDate}" readonly>
                            </div>
                            <div class="form-group">
                                <label>交易类型:</label>
                                <div class="checkbox-group" id="replyTradeTypeGroup">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-type-socks" name="replyTradeType" value="袜子">
                                        <label for="reply-type-socks">袜子</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-type-underwear" name="replyTradeType" value="内裤">
                                        <label for="reply-type-underwear">内裤</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-type-shoes" name="replyTradeType" value="鞋">
                                        <label for="reply-type-shoes">鞋</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-type-other" name="replyTradeType" value="其他">
                                        <label for="reply-type-other">其他</label>
                                    </div>
                                </div>
                                <div id="replyTradeTypeOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="replyTradeTypeOther" placeholder="请输入其他交易类型">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>定向人群:</label>
                                <div class="checkbox-group" id="replyTargetGroup">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-military" name="replyTarget" value="军">
                                        <label for="reply-target-military">军</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-police" name="replyTarget" value="警">
                                        <label for="reply-target-police">警</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-fire" name="replyTarget" value="消">
                                        <label for="reply-target-fire">消</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-security" name="replyTarget" value="保安">
                                        <label for="reply-target-security">保安</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-worker" name="replyTarget" value="民工">
                                        <label for="reply-target-worker">民工</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="reply-target-other" name="replyTarget" value="其他">
                                        <label for="reply-target-other">其他</label>
                                    </div>
                                </div>
                                <div id="replyTargetOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="replyTargetOther" placeholder="请输入其他定向人群">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>交易方式:</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="reply-method-delivery" name="replyTradeMethod" value="快递" checked>
                                        <label for="reply-method-delivery">快递</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="reply-method-meet" name="replyTradeMethod" value="面交">
                                        <label for="reply-method-meet">面交</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="reply-method-other" name="replyTradeMethod" value="其他">
                                        <label for="reply-method-other">其他</label>
                                    </div>
                                </div>
                                <div id="replyMethodOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="replyMethodOther" placeholder="请输入其他交易方式">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>交易价格:</label>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <input type="radio" id="price-original" name="replyPrice" value="原帖价格" checked>
                                        <label for="price-original">原帖价格</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="price-reply" name="replyPrice" value="回帖价格">
                                        <label for="price-reply">回帖价格</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="price-other" name="replyPrice" value="其他">
                                        <label for="price-other">其他</label>
                                    </div>
                                </div>
                                <div id="replyPriceOtherContainer" style="display: none; margin-top: 10px;">
                                    <input type="text" id="replyPriceOther" placeholder="请输入其他价格">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notes">备注:</label>
                                <textarea id="notes" required></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn">提交</button>
                                <button type="button" class="btn btn-secondary" id="cancelReplyForm">取消</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            // 添加表单到页面
            const formContainer = document.createElement('div');
            formContainer.innerHTML = formHtml;
            document.body.appendChild(formContainer.firstChild);
            
            // 添加事件监听器
            document.getElementById('reply-type-other').addEventListener('change', function() {
                document.getElementById('replyTradeTypeOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('reply-target-other').addEventListener('change', function() {
                document.getElementById('replyTargetOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('reply-method-other').addEventListener('change', function() {
                document.getElementById('replyMethodOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('price-other').addEventListener('change', function() {
                document.getElementById('replyPriceOtherContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('cancelReplyForm').addEventListener('click', function() {
                document.getElementById('replyModal').remove();
            });
            
            document.getElementById('replyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 收集交易类型
                const tradeTypes = [];
                document.querySelectorAll('input[name="replyTradeType"]:checked').forEach(cb => {
                    if (cb.value === '其他') {
                        const otherValue = document.getElementById('replyTradeTypeOther').value;
                        if (otherValue) tradeTypes.push(`其他: ${otherValue}`);
                    } else {
                        tradeTypes.push(cb.value);
                    }
                });
                
                // 收集定向人群
                const targets = [];
                document.querySelectorAll('input[name="replyTarget"]:checked').forEach(cb => {
                    if (cb.value === '其他') {
                        const otherValue = document.getElementById('replyTargetOther').value;
                        if (otherValue) targets.push(`其他: ${otherValue}`);
                    } else {
                        targets.push(cb.value);
                    }
                });
                
                // 获取交易方式
                let tradeMethod = document.querySelector('input[name="replyTradeMethod"]:checked').value;
                if (tradeMethod === '其他') {
                    const otherValue = document.getElementById('replyMethodOther').value;
                    if (otherValue) tradeMethod = `其他: ${otherValue}`;
                }
                
                // 获取交易价格
                let price = document.querySelector('input[name="replyPrice"]:checked').value;
                if (price === '其他') {
                    const otherValue = document.getElementById('replyPriceOther').value;
                    if (otherValue) price = `其他: ${otherValue}`;
                }
                
                const reply = {
                    id: Date.now(),
                    originalPostId: document.getElementById('originalPostId').value,
                    replyId: document.getElementById('replyId').value,
                    nickname: document.getElementById('replyNickname').value,
                    phone: document.getElementById('replyPhone').value,
                    date: document.getElementById('replyDate').value,
                    tradeTypes: tradeTypes.join(', '),
                    targets: targets.join(', '),
                    tradeMethod: tradeMethod,
                    price: price,
                    notes: document.getElementById('notes').value
                };
                
                replies.push(reply);
                saveDataToStorage();
                updateReplyTable();
                
                // 移除表单
                document.getElementById('replyModal').remove();
                
                showMessage('回复成功', 'success');
            });
        }
        
        // 更新回复表格
        function updateReplyTable(filteredReplies = null) {
            const tableBody = document.querySelector('#replyTable tbody');
            const data = filteredReplies || replies;
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="11" class="empty-data">等待发帖中</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            data.forEach(reply => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${reply.originalPostId}</td>
                    <td>${reply.replyId}</td>
                    <td>${reply.nickname}</td>
                    <td>${reply.phone}</td>
                    <td>${reply.date}</td>
                    <td>${reply.tradeTypes}</td>
                    <td>${reply.targets}</td>
                    <td>${reply.tradeMethod}</td>
                    <td>${reply.price}</td>
                    <td>${reply.notes}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small btn-secondary" onclick="editReply(${reply.id})">修改</button>
                            <button class="btn btn-small btn-danger" onclick="deleteReply(${reply.id})">删除</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // 搜索回复
        function searchReplies() {
            const searchTerm = document.getElementById('replySearch').value.toLowerCase();
            if (!searchTerm) {
                updateReplyTable();
                return;
            }
            
            const filtered = replies.filter(reply => 
                reply.originalPostId.toLowerCase().includes(searchTerm) ||
                reply.replyId.toLowerCase().includes(searchTerm) ||
                reply.nickname.toLowerCase().includes(searchTerm) ||
                reply.phone.includes(searchTerm)
            );
            
            updateReplyTable(filtered);
        }
        
        // 编辑回复
        function editReply(id) {
            const reply = replies.find(r => r.id === id);
            if (!reply) return;
            
            // 这里可以添加编辑功能
            // 由于时间关系，这里只显示一个提示
            showMessage('编辑功能将在后续版本中实现', 'success');
        }
        
        // 删除回复
        function deleteReply(id) {
            if (confirm('确定要删除此回复吗？')) {
                replies = replies.filter(r => r.id !== id);
                saveDataToStorage();
                updateReplyTable();
                showMessage('回复已删除', 'success');
            }
        }
        
        // 设置文件上传
        function setupFileUpload(inputId, areaId, handler) {
            const fileInput = document.getElementById(inputId);
            const uploadArea = document.getElementById(areaId);
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#4a90e2';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#ccc';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#ccc';
                if (e.dataTransfer.files.length) {
                    handler(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handler(e.target.files[0]);
                }
            });
        }
        
        // 处理LOGO上传
        function handleLogoUpload(file) {
            if (!file.type.match('image/jpeg') && !file.type.match('image/jpg') && !file.type.match('image/png')) {
                showMessage('只支持JPG、JPEG、PNG格式的图片', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                settings.logo = e.target.result;
                saveDataToStorage();
                updateSettingsPreview();
                showMessage('LOGO上传成功', 'success');
            };
            reader.readAsDataURL(file);
        }
        
        // 处理背景上传
        function handleBackgroundUpload(file) {
            if (!file.type.match('image/jpeg') && !file.type.match('image/jpg') && !file.type.match('image/png')) {
                showMessage('只支持JPG、JPEG、PNG格式的图片', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                settings.background = e.target.result;
                saveDataToStorage();
                updateSettingsPreview();
                document.body.style.backgroundImage = `url(${settings.background})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                showMessage('背景图片上传成功', 'success');
            };
            reader.readAsDataURL(file);
        }
        
        // 处理戳戳我图片上传
        function handlePokedMeUpload(file) {
            if (!file.type.match('image/jpeg') && !file.type.match('image/jpg') && !file.type.match('image/png')) {
                showMessage('只支持JPG、JPEG、PNG格式的图片', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                settings.pokedMe = e.target.result;
                saveDataToStorage();
                updateSettingsPreview();
                showMessage('戳戳我图片上传成功', 'success');
            };
            reader.readAsDataURL(file);
        }
        
        // 更新设置预览
        function updateSettingsPreview() {
            // LOGO预览
            const logoPreview = document.getElementById('logoPreview');
            if (settings.logo) {
                logoPreview.innerHTML = `<img src="${settings.logo}" alt="LOGO预览">`;
                document.getElementById('siteLogo').innerHTML = `<img src="${settings.logo}" alt="网站LOGO">`;
            } else {
                logoPreview.innerHTML = '<div class="empty-data">未上传LOGO</div>';
                document.getElementById('siteLogo').innerHTML = '<div class="logo-placeholder">LOGO</div>';
            }
            
            // 背景预览
            const bgPreview = document.getElementById('bgPreview');
            if (settings.background) {
                bgPreview.innerHTML = `<img src="${settings.background}" alt="背景预览">`;
            } else {
                bgPreview.innerHTML = '<div class="empty-data">未上传背景</div>';
            }
            
            // 戳戳我预览
            const pokedMePreview = document.getElementById('pokedMePreview');
            if (settings.pokedMe) {
                pokedMePreview.innerHTML = `<img src="${settings.pokedMe}" alt="戳戳我预览">`;
            } else {
                pokedMePreview.innerHTML = '<div class="empty-data">未上传图片</div>';
            }
            
            // 更新戳戳我标签页
            updatePokedMeImage();
        }
        
        // 更新戳戳我图片
        function updatePokedMeImage() {
            const container = document.getElementById('pokedMeImageContainer');
            if (settings.pokedMe) {
                container.innerHTML = `<img src="${settings.pokedMe}" alt="戳戳我">`;
            } else {
                container.innerHTML = '<div class="empty-data">请先在设置页面上传图片</div>';
            }
        }
        
        // 显示图片模态框
        function showImageModal(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('imageModal').style.display = 'flex';
        }
        
        // 隐藏图片模态框
        function hideImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        // 显示消息
        function showMessage(text, type) {
            const messageDiv = document.getElementById('passwordMessage');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // 保存数据到本地存储
        function saveDataToStorage() {
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('posts', JSON.stringify(posts));
            localStorage.setItem('replies', JSON.stringify(replies));
            localStorage.setItem('settings', JSON.stringify(settings));
        }
        
        // 从本地存储加载数据
        function loadDataFromStorage() {
            const accountsData = localStorage.getItem('accounts');
            const postsData = localStorage.getItem('posts');
            const repliesData = localStorage.getItem('replies');
            const settingsData = localStorage.getItem('settings');
            
            if (accountsData) accounts = JSON.parse(accountsData);
            if (postsData) posts = JSON.parse(postsData);
            if (repliesData) replies = JSON.parse(repliesData);
            if (settingsData) settings = JSON.parse(settingsData);
        }
    </script>
</body>
</html>
